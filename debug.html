<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Simulador de Ecossistema</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #e0e0e0; padding: 20px; }
        .debug-panel { background: #2a2a2a; padding: 20px; border-radius: 8px; margin: 10px 0; }
        button { background: #4a4a4a; color: white; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; border-radius: 4px; }
        button:hover { background: #5a5a5a; }
        .log { background: #1a1a1a; padding: 10px; border-radius: 4px; margin: 10px 0; max-height: 300px; overflow-y: auto; }
        .error { color: #ff6b6b; }
        .success { color: #4ecdc4; }
        .warning { color: #ffe66d; }
    </style>
</head>
<body>
    <h1>üîç Debug - Simulador de Ecossistema</h1>

    <div class="debug-panel">
        <h2>üéÆ Controles de Debug</h2>
        <button onclick="runDiagnostics()">Executar Diagn√≥stico</button>
        <button onclick="forceRedraw()">For√ßar Redesenho</button>
        <button onclick="testSimulation()">Testar Simula√ß√£o</button>
        <button onclick="openSimulator()">Abrir Simulador</button>
        <button onclick="clearLogs()">Limpar Logs</button>
    </div>

    <div class="debug-panel">
        <h2>üìä Logs</h2>
        <div id="logContainer" class="log"></div>
    </div>

    <div class="debug-panel">
        <h2>üìà Estado do Simulador</h2>
        <div id="stateContainer"></div>
    </div>

    <script>
        // Fun√ß√£o para log
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            logContainer.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
        }

        function runDiagnostics() {
            log('üîç Iniciando diagn√≥stico...');

            // Verificar se simulador est√° carregado
            const simulatorWindow = window.open('http://localhost:8080/simulador-ecossistema.html', 'simulator');
            if(!simulatorWindow) {
                log('‚ùå N√£o foi poss√≠vel abrir o simulador. Verifique se o servidor est√° rodando.', 'error');
                return;
            }

            setTimeout(() => {
                try {
                    const sim = simulatorWindow.window.ecoSim;
                    if(!sim) {
                        log('‚ùå Objeto simulador n√£o encontrado.', 'error');
                        return;
                    }

                    log('‚úÖ Simulador encontrado!', 'success');
                    log(`üìä Estado: ${sim.running ? 'Rodando' : 'Pausado'}`);
                    log(`üë• Agentes: ${sim.herb.length} herb√≠voros, ${sim.carn.length} carn√≠voros`);
                    log(`üå± Plantas: ${sim.grid.length} c√©lulas`);
                    log(`üìè Canvas: ${sim.W}x${sim.H}`);
                    log(`‚ö° FPS: ${sim.fps}`);

                    updateStateDisplay(sim);
                } catch(e) {
                    log(`‚ùå Erro ao acessar simulador: ${e.message}`, 'error');
                }
            }, 2000);
        }

        function forceRedraw() {
            log('üîÑ Tentando for√ßar redesenho...');
            const simulatorWindow = window.open('', 'simulator');
            if(simulatorWindow && simulatorWindow.window.forceRedraw) {
                simulatorWindow.window.forceRedraw();
                log('‚úÖ Redesenho solicitado', 'success');
            } else {
                log('‚ùå Janela do simulador n√£o encontrada', 'error');
            }
        }

        function testSimulation() {
            log('üß™ Testando simula√ß√£o...');
            const simulatorWindow = window.open('', 'simulator');
            if(simulatorWindow && simulatorWindow.window.testSimulation) {
                simulatorWindow.window.testSimulation();
                log('‚úÖ Teste solicitado', 'success');
            } else {
                log('‚ùå Janela do simulador n√£o encontrada', 'error');
            }
        }

        function openSimulator() {
            window.open('http://localhost:8080/simulador-ecossistema.html', 'simulator');
            log('üåê Simulador aberto em nova aba', 'success');
        }

        function updateStateDisplay(sim) {
            const stateContainer = document.getElementById('stateContainer');
            stateContainer.innerHTML = `
                <strong>Estado da Simula√ß√£o:</strong><br>
                ‚Ä¢ Rodando: ${sim.running ? '‚úÖ' : '‚ùå'}<br>
                ‚Ä¢ Herb√≠voros: ${sim.herb.length}<br>
                ‚Ä¢ Carn√≠voros: ${sim.carn.length}<br>
                ‚Ä¢ C√©lulas de plantas: ${sim.grid.length}<br>
                ‚Ä¢ Dimens√µes: ${sim.W}x${sim.H}<br>
                ‚Ä¢ FPS: ${sim.fps}<br>
                ‚Ä¢ Tempo: ${sim.time.toFixed(1)}s<br>
                ‚Ä¢ Velocidade: ${sim.speed}x<br>
            `;
        }

        // Inicializa√ß√£o
        log('üîß Debug inicializado');
        log('üí° Use os bot√µes acima para diagnosticar problemas');
        log('üìù Verifique o console do navegador (F12) para mais detalhes');
    </script>
</body>
</html>

